---
{{/* vim: set filetype=mustache: */}}

{{/*
  Expand the name of the chart.
*/}}
{{- define "app.name" -}}
{{- default .Chart.Name .Values.nameOverride | trunc 63 | trimSuffix "-" -}}
{{- end -}}

{{/*
  Create a default fully qualified app name.
  We truncate at 63 chars because some Kubernetes name fields are limited
  to this (by the DNS naming spec). If release name contains chart name
  it will be used as a full name.
*/}}
{{- define "app.fullname" -}}
{{- if .Values.fullnameOverride -}}
{{- .Values.fullnameOverride | trunc 63 | trimSuffix "-" -}}
{{- else -}}
{{- $name := default .Chart.Name .Values.nameOverride -}}
{{- if contains $name .Release.Name -}}
{{- .Release.Name | trunc 63 | trimSuffix "-" -}}
{{- else -}}
{{- printf "%s-%s" .Release.Name $name | trunc 63 | trimSuffix "-" -}}
{{- end -}}
{{- end -}}
{{- end -}}

{{/*
  Create chart name and version as used by the chart label.
*/}}
{{- define "app.chart" -}}
{{- printf "%s-%s" .Chart.Name .Chart.Version | replace "+" "_" | trunc 63 | trimSuffix "-" -}}
{{- end -}}

{{/*
  Lookup the confguration file setting name, given both the factomd object and the key
*/}}
{{- define "factomd.configKey" -}}
{{- $global := .factomd.configNames.global -}}
{{- $network := index .factomd.configNames .factomd.network -}}
{{- $configKey := index (merge $global $network) .key -}}
{{- required (printf "No configuration setting name was found for key '%s'" .key) $configKey -}}
{{- end -}}

{{/*
  Lookup the confguration file setting value, given both the Values object and the Key name
*/}}
{{- define "factomd.configValue" -}}
{{- $defaults := .Values.factomd.defaults -}}
{{- $overrides := .Values.factomd.overrides -}}
{{- $global := $defaults.global -}}
{{- $network := index $defaults .Values.factomd.network -}}
{{- $merged := merge $overrides $global $network -}}
{{- index $merged .key -}}
{{- end -}}

{{/*
  Lookup all confguration file settings
*/}}
{{- define "factomd.configValues" -}}
{{- $defaults := .Values.factomd.defaults -}}
{{- $overrides := .Values.factomd.overrides -}}
{{- $global := $defaults.global -}}
{{- $network := index $defaults .Values.factomd.network -}}
{{- merge $overrides $global $network -}}
{{- end -}}
...
